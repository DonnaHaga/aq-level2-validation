---
title: "Annual Data Validation"
author: "Air Quality Section | Regional Operations Branch"
date: "`r format(Sys.time(), '%B %d, %Y')`"
params:
  preppedData: !r stringr::str_c("./preppedData/",dir('./preppedData')[20],collapse="")
  year: 2020
site: bookdown::bookdown_site
output: 
  bookdown::gitbook:
    config:
      toc:
        collapse: section
---

```{r setup,echo=FALSE,warning=FALSE,message=FALSE}
knitr::opts_chunk$set(warning = FALSE,
                      message = FALSE,
                      echo = FALSE)

library(tidyverse)
library(openair)
library(Hmisc)
library(xts)
library(plotly)
library(RCurl)
library(DT)
library(feather)
library(magrittr)
library(readxl)
library(gdata)

# functions to calculate SAS stats from hourly data
source("./SAS_from_ftpData/pm25sasFcn.R")
source("./SAS_from_ftpData/pm10sasFcn.R")
source("./SAS_from_ftpData/no2sasFcn.R")
source("./SAS_from_ftpData/nosasFcn.R")
source("./SAS_from_ftpData/so2sasFcn.R")
source("./SAS_from_ftpData/o3sasFcn.R")
source("./SAS_from_ftpData/h2ssasFcn.R")
source("./SAS_from_ftpData/trssasFcn.R")
source("./SAS_from_ftpData/cosasFcn.R")

# path to ecms sas reports saved locally:
sasReports<-"C:/HagaR/AnnualDataValidation/SAS_reports"

source("plotlyFcn.R")
source("emptyPlot.R")

```

```{r importData}
data<-readRDS(params$preppedData) 

# data<-readRDS("./preppedData/Golden Helipad.rds")
```


```{r dailyData}
day<-data %>%
    # rename to date for openair
    dplyr::rename(date=DATE_PST) %>%
    dplyr::group_by(STATION_NAME,PARAMETER,INSTRUMENT) %>%
    dplyr::group_modify(~ openair::timeAverage(.x,
                                               pollutant="PARAMETER",
                                               avg.time = "day",
                                               data.thresh = 75)
    ) %>%
    ungroup %>%
    dplyr::rename(DATE_PST=date)

```


```{r hourlyAndDaily}

# combine hourly and day data sets in one tidy tibble
allData<-data %>%
  dplyr::select(names(day)) %>%
  dplyr::mutate(TIME_AVG = "Hourly") %>%
  dplyr::bind_rows(.,
                   day %>%
                     dplyr::mutate(TIME_AVG = "Daily"))

# allData %>%
#   dplyr::filter(TIME_AVG=="Hourly")
# 
# allData %>%
#   dplyr::filter(TIME_AVG=="Daily")
```


# Preamble {-}

Stations included in this analysis include: 

`r data %>% dplyr::pull(STATION_NAME) %>% unique %>% sort`.

Link to [ECMS SAS summaries, summary plots, and data capture stats](https://envistaweb.env.gov.bc.ca/aqo/stats/StatIndex.html).